{include file="common/head"/}
<script>
    var ADMIN = '__STATIC__/admin/';
</script>
<div class="layui-layout layui-layout-admin kit-layout-admin">
  <!-- 顶部导航 -->
  <div class="layui-header">
    <div class="layui-logo" style="text-align:left;padding-left:20px;"><i class="fa fa-get-pocket"></i> {:lang('systemCenter')}</div>
    <div class="layui-logo kit-logo-mobile">{:lang('keywords')}</div>
    <ul id="top-kit-nav" class="layui-nav layui-layout-left kit-nav">
      <!-- 控制台 -->
      <li class="layui-nav-item"><a href="javascript:;" data-id='100'>{:lang('controlPanel')}</a></li>
  <!--     后台管理
  <li class="layui-nav-item">
    <a href="javascript:;" data-id='101'>{:lang('systemManage')}</a>
    <dl class="layui-nav-child">
      <dd><a href="javascript:;" data-url="{:url('system/index')}" data-title="{:lang('systemSet')}" kit-target data-id='1011'><span>{:lang('systemSet')}</span></a></dd>
      <dd><a href="javascript:;" data-url="{:url('system/manageList')}" data-title="{:lang('manageList')}" kit-target data-id='1012'><span>{:lang('manageList')}</span></a></dd>
    </dl>
  </li> -->
   <!--    会员管理
   <li class="layui-nav-item">
     <a href="javascript:;" data-id='102'>{:lang('vipManage')}</a>
     <dl class="layui-nav-child">
       <dd><a href="javascript:;" data-url="{:url('agent/insManage')}" data-title="{:lang('insList')}" kit-target data-id='1021'><span>{:lang('insList')}</span></a></dd>
       <dd><a href="javascript:;" data-url="{:url('agent/agentManage')}" data-title="{:lang('agentManage')}" kit-target data-id='1022'><span>{:lang('agentManage')}</span></a></dd>
       <dd><a href="javascript:;" data-url="{:url('agent/agentList')}" data-title="{:lang('agentList')}" kit-target data-id='1023'><span>{:lang('agentList')}</span></a></dd>
       <dd><a href="javascript:;" data-url="{:url('agent/agentCheck')}" data-title="{:lang('agentCheck')}" kit-target data-id='1024'><span>{:lang('agentCheck')}</span></a></dd>
     </dl>
   </li> -->
      <!-- 风控管理 
      <li class="layui-nav-item">
        <a href="javascript:;" data-id='103'>{:lang('riskManage')}</a>
        <dl class="layui-nav-child">
          <dd><a href="javascript:;" data-url="{:url('risk/riskSetting')}" data-title="{:lang('riskSetting')}" kit-target data-id='1031'><span>{:lang('riskSetting')}</span></a></dd>
          <dd><a href="javascript:;" data-url="{:url('risk/productManage')}" data-title="{:lang('productManage')}" kit-target data-id='1032'><span>{:lang('productManage')}</span></a></dd>
          <dd><a href="javascript:;" data-url="{:url('risk/contractManage')}" data-title="{:lang('contractManage')}" kit-target data-id='1033'><span>{:lang('contractManage')}</span></a></dd>
        </dl>
      </li>-->
      <!-- 接口配置 -->
      <li class="layui-nav-item">
        <a href="javascript:;" data-id='104'>{:lang('apiManage')}</a>
        <dl class="layui-nav-child">
         <!--  <dd><a href="javascript:;" data-url="{:url('api/payApi')}" data-title="{:lang('payApi')}" kit-target data-id='1041'><span>{:lang('payApi')}</span></a></dd> -->
          <dd><a href="javascript:;" data-url="{:url('api/smsApi')}" data-title="{:lang('smsApi')}" kit-target data-id='1042'><span>{:lang('smsApi')}</span></a></dd>
       <dd><a href="javascript:;" data-url="{:url('sms/smsList')}" data-title="{:lang('smsManage')}" kit-target data-id='109'><span>{:lang('smsManage')}</span></a></dd>
        </dl>
      </li>
      <!-- 认证管理 -->
     <!--  <li class="layui-nav-item"><a href="javascript:;" data-url="{:url('cert/index')}" data-title="{:lang('certManage')}" kit-target data-id='105'><span>{:lang('certManage')}</span></a></li> -->
      <!-- 投资人管理 
      <li class="layui-nav-item"><a href="javascript:;" data-url="{:url('investor/index')}" data-title="{:lang('investorManage')}" kit-target data-id='106'><span>{:lang('investorManage')}</span></a></li>-->
      <!-- 跟单管理
      <li class="layui-nav-item"><a href="javascript:;" data-url="{:url('documentary/index')}" data-title="{:lang('documentary')}" kit-target data-id='107'><span>{:lang('documentary')}</span></a></li> -->
	  <!-- 期货公司配置管理 -->
 <!--      <li class="layui-nav-item">
   <a href="javascript:;" data-id='108'>{:lang('sysConfig')}</a>
   <dl class="layui-nav-child">
     <dd><a href="javascript:;" data-url="{:url('config/zgList')}" data-title="{:lang('zgList')}" kit-target data-id='1081'><span>{:lang('zgList')}</span></a></dd>
     <dd><a href="javascript:;" data-url="{:url('config/sxfList')}" data-title="{:lang('sxfList')}" kit-target data-id='1082'><span>{:lang('sxfList')}</span></a></dd>
     <dd><a href="javascript:;" data-url="{:url('config/fkList')}" data-title="{:lang('fkList')}" kit-target data-id='1083'><span>{:lang('fkList')}</span></a></dd>
     <dd><a href="javascript:;" data-url="{:url('config/mzhList')}" data-title="{:lang('mzhList')}" kit-target data-id='1084'><span>{:lang('mzhList')}</span></a></dd>
   </dl>
 </li> -->
	  <!-- 短信管理 
      <li class="layui-nav-item"><a href="javascript:;" data-url="{:url('sms/smsList')}" data-title="{:lang('smsManage')}" kit-target data-id='109'><span>{:lang('smsManage')}</span></a></li>-->
	  <li class="layui-nav-item">
        <a href="javascript:;" data-id='999'>{:lang('authManage')}</a>
        <dl class="layui-nav-child">
          <dd><a href="javascript:;" data-url="{:url('auth/adminGroup')}" data-title="{:lang('authGroup')}" kit-target data-id='9991'><span>{:lang('authGroup')}</span></a></dd>
          <dd><a href="javascript:;" data-url="{:url('auth/adminRule')}" data-title="{:lang('authConfig')}" kit-target data-id='9992'><span>{:lang('authConfig')}</span></a></dd>
        </dl>
      </li>
    </ul>
    <ul class="layui-nav layui-layout-right kit-nav">
      <li class="layui-nav-item" id="msg">
        <a href="javascript:;" data-url="{:url('system/systemmsg')}"  data-title="系统消息" kit-target data-id='234' style="margin-left: 12px;">
          系统消息
        </a>
        <span class="layui-badge" id="msgcount">0</span>
      </li>
      <li class="layui-nav-item" id="cache">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-size-16">&#xe640;</i> 清理缓存
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-size-16">&#xe61b;</i> 皮肤</a>
        </a>
        <dl class="layui-nav-child skin">
          <dd><a href="javascript:;" data-skin="default" style="color:#393D49;"><i class="layui-icon">&#xe658;</i> 默认</a></dd>
          <dd><a href="javascript:;" data-skin="orange" style="color:#ff6700;"><i class="layui-icon">&#xe658;</i> 橘子橙</a></dd>
          <dd><a href="javascript:;" data-skin="green" style="color:#00a65a;"><i class="layui-icon">&#xe658;</i> 原谅绿</a></dd>
          <dd><a href="javascript:;" data-skin="pink" style="color:#FA6086;"><i class="layui-icon">&#xe658;</i> 少女粉</a></dd>
          <dd><a href="javascript:;" data-skin="blue.1" style="color:#00c0ef;"><i class="layui-icon">&#xe658;</i> 天空蓝</a></dd>
          <dd><a href="javascript:;" data-skin="red" style="color:#dd4b39;"><i class="layui-icon">&#xe658;</i> 枫叶红</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item">
        <a href="javascript:;">
          <img src='__STATIC__/admin/images/face1.png' class="layui-nav-img">
          <span>{$user.username}</span>
        </a>
        <dl class="layui-nav-child">
          <dd>
            <a href="javascript:;" data-url="{:url('manage/info')}" data-title="基本资料" kit-target data-id='21'><span>基本资料</span></a>
          </dd>
          <dd>
            <a href="javascript:;" data-url="{:url('manage/pwdSet')}" data-title="安全设置" kit-target data-id='22'><span>安全设置</span></a>
          </dd>
        </dl>
      </li>
      <li class="layui-nav-item" id="loginout"><a href="javascript:;"><i class="fa fa-sign-out" aria-hidden="true"></i> 退出</a></li>
    </ul>
  </div>
  <!-- 左侧导航 -->
  <div class="layui-side layui-bg-black kit-side">
    <div class="layui-side-scroll">
      <div class="kit-side-fold"><i class="fa fa-navicon" aria-hidden="true"></i></div>
      <!-- 左侧导航区域 -->
      <ul class="layui-nav layui-nav-tree" id="left-kit-navbar" lay-filter="kitNavbar" kit-navbar>
		{volist name="menus" id="vo" key="key"}
        <li class="layui-nav-item layui-nav-itemed">
          <a href="javascript:;" data-id="{$vo.id}"><i class="fa {$vo.icon}" aria-hidden="true"></i><span> {$vo.title}</span></a>
          <dl class="layui-nav-child">
			{volist name="$vo.children" id="co" key="k"}
            <dd>
              <a href="javascript:;" data-url="{$co.href}" data-icon="{$co.icon}" data-title="{$co.title}" kit-target data-id='{$co.id}'><i class="fa {$co.icon}" aria-hidden="true"></i><span> {$co.title}</span></a>
            </dd>
			{/volist}
          </dl>
        </li>
		{/volist}
      </ul>
    </div>
  </div>
  <!-- 内容主体区域 -->
  <div class="layui-body" id="container">
    <div style="padding: 15px;"><i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop">&#xe63e;</i> 请稍等...</div>
  </div>
  <!-- 底部区域 -->
  <div class="layui-footer">2018 &copy; {:lang('systemTitle')} 版权所有</div>
</div>
{include file="common/foot"/}
<script src="/static/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script>
  getCountMsg(1);
  var message;
  layui.config({
      base: ADMIN+'build/js/',
      version: '1.0.1'
  }).use(['app', 'message'], function() {
    var app = layui.app,
        $ = layui.jquery,
        layer = layui.layer;
    //将message设置为全局以便子页面调用
    message = layui.message;
    //主入口
    app.set({
      type: 'iframe'
    }).init();
    //清除缓存
    $('#cache').click(function () {
      layer.confirm('确认要清除缓存？', {icon: 3}, function (data) {
        $.post('{:url("clear")}', {}, function (data) {
          layer.msg(data.info, {icon: 6}, function (index) {
            layer.close(index);
            window.location.href = data.url;
          });
        });
      });
    });
    //注销退出
    $('#loginout').click(function(){
        layer.confirm('您确定要退出吗？',{icon:3},function(data){
            $.post('{:url("loginout")}',{},function(data){
                layer.msg(data.info,{icon:6,time:1000},function(index){
                    layer.close(index);
                    window.location.href=data.url;
                });
            });
        });
    });
    //更换后台皮肤
    $('dl.skin > dd').on('click', function() {
      var $that = $(this);
      var skin = $that.children('a').data('skin');
      switchSkin(skin);
    });
    var setSkin = function(value) {
          layui.data('kit_skin', {
            key: 'skin',
            value: value
          });
        },
        getSkinName = function() {
          return layui.data('kit_skin').skin;
        },
        switchSkin = function(value) {
          var _target = $('link[kit-skin]')[0];
          _target.href = _target.href.substring(0, _target.href.lastIndexOf('/') + 1) + value + _target.href.substring(_target.href.lastIndexOf('.'));
          setSkin(value);
        },
        initSkin = function() {
          var skin = getSkinName();
          switchSkin(skin === undefined ? 'default' : skin);
        }();
  });
  function getmsg(){
    $.ajax({
      type: 'POST',
      url: '/index/otherapi/getmsg',
      dataType: 'json',
      data: {typelog:'2'},
      async: false,
      success: function (result) {
        //layer.close(layer1);
        if (0 === result.code) {
          res = result;
          $("#id").val();
          $("#stock").val();
          var list=res.data;
          var html='';
          $(list).each(function(index,value){
            html +=' <div class="alert alert-danger"> '+value.create_time+' '+value.content+' <a class="alert-link" href="#" onclick="updateMsgById('+value.id+','+"'"+value.url+"')"+'";">立即处理</a> </div>'
          });
          $("#msg_content").html(html);

          $('#Modal1').modal();
        } else {
          //修改失败
          res = false;
          layer.msg(result.msg, {icon: 5});
        }
      },
      error: function () {
        res = false;
        layer.msg('服务器错误！请稍后重试', {icon: 2});
      }
    })

  }
 
  //保存按钮
  function save(){
    $.ajax({
      type: 'POST',
      url: '/index/otherapi/updateMsg',
      dataType: 'json',
      data: {typelog:'2'},
      async: false,
      success: function (result) {
        //layer.close(layer1);
        if (0 === result.code) {
          res = result;
          layer.msg(result.msg, {icon: 1});
          $("#msgcount").html('');
          $('#Modal1').modal('hide');
        } else {
          //修改失败
          res = false;
          layer.msg(result.msg, {icon: 5});
        }
      },
      error: function () {
        res = false;
        layer.msg('服务器错误！请稍后重试', {icon: 2});
      }
    })
  }

  function updateMsgById(Id,url){
    $.ajax({
      type: "POST",
      url: '/index/otherapi/updateMsg',
      data: {
        id:Id
      },
      async: false,//同步等待结果的返回
      success:function(data){
        if(data.code==0){
          window.location.href=url;
        }
      }
    });
  }

  //获取未读消息条数
  function  getCountMsg(value) {
    if(value==1){
       setTimeout(function () {
          getCountMsg(2);
        },10000);
       return;
    }
    //拉取询价记录列表
    $.ajax({
      type: 'POST',
      url: "/index/otherapi/getCountMsg",
      dataType: 'json',
      data: {
        userid: localStorage.id,
        auth: localStorage.auth
      },
      async: false,
      success: function(data) {
        var count_num = $("#msgcount").html();
        if(count_num !=data.count && data.count>0){
          layer.msg('有新的系统消息，请查收！', {icon: 7});
        }
        $("#msgcount").html(data.count);
        setTimeout(function () {
          getCountMsg();
        },10000);
      },
      error: function() {
        $("#msgcount").html('');
      }
    });
  }
</script>
</body>
</html>

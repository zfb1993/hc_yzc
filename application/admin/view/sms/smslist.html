{include file="common/head"/}
<script>
    var ADMIN = '__STATIC__/admin/';
</script>
<div class="layui-layout layui-layout-admin kit-layout-admin">
  <div class="layui-padded-15">
    <blockquote class="layui-elem-quote layui-text">
      <h4>当前位置：{:lang('smsManage')}<i class="fa fa-angle-right layui-padded-l-10 layui-padded-r-10"></i>{:lang('smsList')}</h4>
    </blockquote>
    <div class="layui-form">
      <table class="layui-table" id="list" lay-filter="list" style="margin-top:0;"></table>
    </div>
  </div>
</div>
{include file="common/foot"/}
<script type="text/html" id="action">
  <a class="layui-btn layui-btn-danger layui-btn-sm" lay-event="del">删除</a>
</script>
<script>
    var message;
    layui.config({
        base: ADMIN+'build/js/',
        version: '1.0.1'
    }).use(['app','form','table','layer','laydate','message'], function() {
        var app = layui.app,
            $ = layui.jquery,
            table = layui.table,
            laydate = layui.laydate,
            form = layui.form,
            layer = layui.layer;
        //将message设置为全局以便子页面调用
        message = layui.message;
        //主入口
        app.set({
            type: 'iframe'
        }).init();
    //列表数据
    var tableIn = table.render({
        elem: '#list',
        url: '{:url("sms/smsList")}',
        method: 'post',
        page: true,
        cols: [[
            {type:'numbers',title:'序号',width:60,fixed: true},
            {field:'mobile',align:'center',title:'手机号', width:150},
            {field:'code',align:'center',title:'验证码', width:100, sort: true},
            {field:'type',align:'center',title:'类型',width:100},
            {field:'add_time', align:'center',title:'发送时间',width:180},
            {field:'result', align:'center', title:'状态',width:120},
            {width: 120, align: 'center', toolbar: '#action',title:'操作'}
        ]],
        limit: 10,
        height: 600 //固定值
    });
    //监听工具条
    table.on('tool(list)', function(obj){
      var data = obj.data;
      if(obj.event === 'detail'){
        //layer.msg('ID：'+ data.id + ' 的查看操作');
      } else if(obj.event === 'del'){
        layer.confirm('真的要删除这条短信吗？', function(index){
          $.post("{:url('sms/smsDel')}",{'id':data.id},function(res){
            if(res.code==1){
              layer.msg(res.msg,{icon: 1, time: 1000},function(){
                obj.del();
				tableIn.reload();
                layer.close(index);
              });
            }else{
              layer.msg(res.msg,{icon: 2, time: 1000},function(){
                layer.close(index);
              });
            }
          });
        });
      } else if(obj.event === 'edit'){
        //layer.alert('编辑行：<br>'+ JSON.stringify(data))
      }
    });
  });
</script>
</body>
</html>
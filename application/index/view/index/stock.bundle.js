!function(t){var e={};function a(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(r,i,function(e){return t[e]}.bind(null,i));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";a.r(e);var r=0,i=8;function o(t){return m(n(p(t),t.length*i))}function n(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var a=1732584193,r=-271733879,i=-1732584194,o=271733878,n=0;n<t.length;n+=16){var s=a,p=r,m=i,g=o;r=h(r=h(r=h(r=h(r=d(r=d(r=d(r=d(r=c(r=c(r=c(r=c(r=l(r=l(r=l(r=l(r,i=l(i,o=l(o,a=l(a,r,i,o,t[n+0],7,-680876936),r,i,t[n+1],12,-389564586),a,r,t[n+2],17,606105819),o,a,t[n+3],22,-1044525330),i=l(i,o=l(o,a=l(a,r,i,o,t[n+4],7,-176418897),r,i,t[n+5],12,1200080426),a,r,t[n+6],17,-1473231341),o,a,t[n+7],22,-45705983),i=l(i,o=l(o,a=l(a,r,i,o,t[n+8],7,1770035416),r,i,t[n+9],12,-1958414417),a,r,t[n+10],17,-42063),o,a,t[n+11],22,-1990404162),i=l(i,o=l(o,a=l(a,r,i,o,t[n+12],7,1804603682),r,i,t[n+13],12,-40341101),a,r,t[n+14],17,-1502002290),o,a,t[n+15],22,1236535329),i=c(i,o=c(o,a=c(a,r,i,o,t[n+1],5,-165796510),r,i,t[n+6],9,-1069501632),a,r,t[n+11],14,643717713),o,a,t[n+0],20,-373897302),i=c(i,o=c(o,a=c(a,r,i,o,t[n+5],5,-701558691),r,i,t[n+10],9,38016083),a,r,t[n+15],14,-660478335),o,a,t[n+4],20,-405537848),i=c(i,o=c(o,a=c(a,r,i,o,t[n+9],5,568446438),r,i,t[n+14],9,-1019803690),a,r,t[n+3],14,-187363961),o,a,t[n+8],20,1163531501),i=c(i,o=c(o,a=c(a,r,i,o,t[n+13],5,-1444681467),r,i,t[n+2],9,-51403784),a,r,t[n+7],14,1735328473),o,a,t[n+12],20,-1926607734),i=d(i,o=d(o,a=d(a,r,i,o,t[n+5],4,-378558),r,i,t[n+8],11,-2022574463),a,r,t[n+11],16,1839030562),o,a,t[n+14],23,-35309556),i=d(i,o=d(o,a=d(a,r,i,o,t[n+1],4,-1530992060),r,i,t[n+4],11,1272893353),a,r,t[n+7],16,-155497632),o,a,t[n+10],23,-1094730640),i=d(i,o=d(o,a=d(a,r,i,o,t[n+13],4,681279174),r,i,t[n+0],11,-358537222),a,r,t[n+3],16,-722521979),o,a,t[n+6],23,76029189),i=d(i,o=d(o,a=d(a,r,i,o,t[n+9],4,-640364487),r,i,t[n+12],11,-421815835),a,r,t[n+15],16,530742520),o,a,t[n+2],23,-995338651),i=h(i,o=h(o,a=h(a,r,i,o,t[n+0],6,-198630844),r,i,t[n+7],10,1126891415),a,r,t[n+14],15,-1416354905),o,a,t[n+5],21,-57434055),i=h(i,o=h(o,a=h(a,r,i,o,t[n+12],6,1700485571),r,i,t[n+3],10,-1894986606),a,r,t[n+10],15,-1051523),o,a,t[n+1],21,-2054922799),i=h(i,o=h(o,a=h(a,r,i,o,t[n+8],6,1873313359),r,i,t[n+15],10,-30611744),a,r,t[n+6],15,-1560198380),o,a,t[n+13],21,1309151649),i=h(i,o=h(o,a=h(a,r,i,o,t[n+4],6,-145523070),r,i,t[n+11],10,-1120210379),a,r,t[n+2],15,718787259),o,a,t[n+9],21,-343485551),a=u(a,s),r=u(r,p),i=u(i,m),o=u(o,g)}return Array(a,r,i,o)}function s(t,e,a,r,i,o){return u(function(t,e){return t<<e|t>>>32-e}(u(u(e,t),u(r,o)),i),a)}function l(t,e,a,r,i,o,n){return s(e&a|~e&r,t,e,i,o,n)}function c(t,e,a,r,i,o,n){return s(e&r|a&~r,t,e,i,o,n)}function d(t,e,a,r,i,o,n){return s(e^a^r,t,e,i,o,n)}function h(t,e,a,r,i,o,n){return s(a^(e|~r),t,e,i,o,n)}function u(t,e){var a=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(a>>16)<<16|65535&a}function p(t){for(var e=Array(),a=(1<<i)-1,r=0;r<t.length*i;r+=i)e[r>>5]|=(t.charCodeAt(r/i)&a)<<r%32;return e}function m(t){for(var e=r?"0123456789ABCDEF":"0123456789abcdef",a="",i=0;i<4*t.length;i++)a+=e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15);return a}var g=o;var f=class{constructor(){this.myws=null,this.lockReconnect=!1}static get ALL_WS(){return"ws://47.104.173.116:9001"}client(t,e,a){if("WebSocket"in window)this.myws=new WebSocket(t);else{if(!("MozWebSocket"in window))return void alert("您的浏览器不支持websocket协议,建议使用新版谷歌、火狐等浏览器，请勿使用IE10以下浏览器，360浏览器请使用极速模式，不要使用兼容模式！");this.myws=new MozWebSocket(t)}this.myws.onopen=(t=>{this.lockReconnect=!0,console.warn("连接成功..."),this.send(a),this.heartbeat()}),this.myws.onmessage=(t=>{let a=JSON.parse(t.data);return a.error||0==a.childid?(console.error("WEBSOCKET返回错误：",a.error||a.childid),void $.alert(a.error||a.childid)):"ReqUserLogin"==a.HandlerID?(console.warn("登陆成功..."),void(_done&&_done())):void e(a)}),this.myws.onclose=(r=>{this.lockReconnect=!1,console.warn("断开.."),setTimeout(()=>{console.warn("尝试重连"),this.client(t,e,a)},3e4)}),this.myws.onerror=(t=>{this.lockReconnect=!1,console.warn("连接错误.."),$.toast("与服务器断开连接","text")})}heartbeat(){this.lockReconnect}send(t){console.log("发送数据...");try{this.myws.send(t)}catch(t){console.warn(t)}}static GETCOUNT(){return`action=AccountAuth&userid=${localStorage.zid}&authcode=${g(localStorage.zid+localStorage.user_name)}`}static REQUSERLOGIN(){return JSON.stringify({UserID:localStorage.id,AuthCode:localStorage.auth,HandlerID:"ReqUserLogin",UseType:1})}static REQQRYINVESTORPOSITION(){return JSON.stringify({UserID:localStorage.id,HandlerID:"ReqQryInvestorPosition"})}static REQQRYTRADINGACCOUNT(){return JSON.stringify({UserID:localStorage.id,HandlerID:"ReqQryTradingAccount"})}static REQORDERINSERT(t){return JSON.stringify({UserID:localStorage.id,Type:t.Type,Num:t.Num,InstrumentID:t.InstrumentID,LimitPrice:t.LimitPrice,HandlerID:"ReqOrderInsert"})}};class y{constructor(){y.datas={},y.datas.stock_id=getQueryString("stock_id"),y.ws9001=new f,y.ws9001.client(f.ALL_WS,this.marketMessage,f.GETCOUNT()),this.init(),this.events(),this.rander($(".weui-bar__item--on").data("chart"))}init(){y.datas.qh=getQueryString("qh"),y.datas.qn=getQueryString("qn"),y.datas.ex=getQueryString("ex"),y.datas.id=getQueryString("id"),$("#qh_name").html(y.datas.qn),$("#qh_id").html(y.datas.qh)}marketMessage(t){if(t&&t.HandlerID)if("onRspQryTradingAccount"==t.HandlerID)$("#buytxt").html(t.Deposit),$("#saletxt").html(t.Withdraw),$("#yue").html(t.TradingAccount.Available),$("#ccyk").html(t.TradingAccount.PositionProfit);else if("OnRtnOrder"==t.HandlerID)-1==t.Order.StatusMsg.indexOf("已提交")&&$.alert(t.Order.StatusMsg);else if("OnRtnTrade"==t.HandlerID){if(1!=t.code)return void alert(t.msg);$.alert("操作成功",()=>{$.closePopup(),location.href="/index/index/position"})}else if("OnRspOrderInsert"==t.HandlerID)t.RspInfo&&$.alert(t.RspInfo.ErrorMsg);else if("OnRspQryInvestorPosition"==t.HandlerID){if(1!=t.code)return void $.alert(t.msg);$.alert("操作成功",()=>{$.closePopup(),location.href="/index/index/position"})}else if("onRtnDepthMarketData"==t.HandlerID&&String(t.DepthMarketData.InstrumentID).toLocaleUpperCase()==y.datas.qh){$("#zxj").html(t.DepthMarketData.LastPrice),$("#zgj").html(t.DepthMarketData.HighestPrice),$("#ccl").html(t.DepthMarketData.OpenInterest),$("#mj").html(t.DepthMarketData.BidPrice1),$("#ask").html("&nbsp;&nbsp;&nbsp;&nbsp;"+t.DepthMarketData.AskVolume1),$("#buytxt").html(t.DepthMarketData.BidPrice1),$("#zdj").html(t.DepthMarketData.LowestPrice),$("#cjl").html(t.DepthMarketData.Volume),$("#mj_").html(t.DepthMarketData.AskPrice1),$("#bid").html("&nbsp;&nbsp;&nbsp;&nbsp;"+t.DepthMarketData.BidVolume1),$("#saletxt").html(t.DepthMarketData.AskPrice1);var e=parseFloat(t.DepthMarketData.LastPrice)-parseFloat(t.DepthMarketData.PreSettlementPrice);e<0?$("#qh").css("background","#1aad19"):$("#qh").css("background","#e64340"),$("#updown_amount").text((e<0?"":"+")+e.toFixed(2));var a=parseFloat(t.DepthMarketData.PreSettlementPrice)/parseFloat(t.DepthMarketData.LastPrice)*100-100;$("#updown_rate").text((e<0?"-":"+")+Math.abs(a).toFixed(2)+"%"),y.datas.UpperLimitPrice=t.DepthMarketData.UpperLimitPrice,y.datas.LowerLimitPrice=t.DepthMarketData.LowerLimitPrice}}calculateMA(t,e){for(var a=[],r=0,i=e.values.length;r<i;r++)if(r<t)a.push("-");else{for(var o=0,n=0;n<t;n++)o+=e.values[r-n][1];a.push(+(o/t).toFixed(3))}return a}splitData(t){for(var e=[],a=[],r=[],i=0;i<t.length;i++)e.push(t[i].splice(0,1)[0]),a.push(t[i]),r.push([i,t[i][4],t[i][0]>t[i][1]?1:-1]);return{categoryData:e,values:a,volumes:r}}rander(t){this.myChart&&this.myChart.dispose(),$("#chart").html('<img src="/static/assets/imgs/preloader.gif">'),this.getOption(t,t=>{this.myChart=echarts.init(document.getElementById("chart")),this.myChart.setOption(t)})}getOption(t,e){if(y.datas[t])e(y.datas[t]);else if("chart1"===t){for(var a=[],r=9;r<15;r++){if(9==r)var i=30;else i=0;for(var o=i;o<60;o++)11!=r&&15!=r&&12!=r?a.push(r+":"+o):o<31&&12!=r&&a.push(r+":"+o)}$.get("http://cqh.1caopan.com/qihuo/Api/getQihuoMinuteData",{stockid:y.datas.qh+"."+y.datas.ex},t=>{var r={animation:!1,noDataLoadingOption:{text:"暂无数据",effect:"bubble",effectOption:{effect:{n:0}}},grid:{left:"3%",right:"3%",bottom:"10%",top:"10%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",data:a,axisLine:{lineStyle:{show:!0,color:"#999"}},splitLine:{show:!0,lineStyle:{color:"#f7f7fa",width:1}}},yAxis:{type:"value",axisLine:{show:!0,lineStyle:{color:"#999",width:0}},max:t=>(t.max+t.min/100).toFixed(2),min:t=>(t.min-t.min/100).toFixed(2),splitLine:{show:!0,lineStyle:{color:"#f7f7fa",width:1}}},series:[{data:t[1],type:"line",lineStyle:{normal:{borderColor:null,color:"#e64340",opacity:.8,height:1,width:1}}}]};y.datas.chart1=r,e(r)},"JSON")}else"chart2"===t?this.getStock(6,t,e):"chart3"===t?this.getStock(7,t,e):"chart4"===t?this.getStock(8,t,e):"chart5"===t?this.getStock(2,t,e):"chart6"===t?this.getStock(3,t,e):"chart7"===t?this.getStock(4,t,e):"chart8"===t?this.getStock(5,t,e):"chart9"===t&&this.getStock(1,t,e)}getStock(t,e,a){$.get("http://cqh.1caopan.com/qihuo/Api/getQihuoKlineData",{stockid:y.datas.qh+"."+y.datas.ex,candle_period:t},t=>{let r=this.splitData(t),i={backgroundColor:"#fff",animation:!0,legend:{top:10,left:"center",data:["MA5","MA10","MA20","MA30"]},tooltip:{trigger:"axis",axisPointer:{type:"cross"},backgroundColor:"rgba(245, 245, 245, 0.8)",borderWidth:1,borderColor:"#ccc",padding:10,textStyle:{color:"#000"},position:(t,e,a,r,i)=>{var o={top:10};return o[["left","right"][+(t[0]<i.viewSize[0]/2)]]=30,o}},axisPointer:{link:{xAxisIndex:"all"},label:{backgroundColor:"#777"}},visualMap:{show:!1,seriesIndex:5,dimension:2,pieces:[{value:1,color:"#ec0000"},{value:-1,color:"#00da3c"}]},grid:[{left:"10%",right:"3%"},{left:"3%",right:"1%",bottom:"0",height:"10%"}],xAxis:[{show:!0,axisLine:{show:!0,lineStyle:{color:"#999",width:0}},type:"category",data:r.categoryData,scale:!0,boundaryGap:!1,splitLine:{show:!0,lineStyle:{color:"#f7f7fa",width:1}},splitNumber:20,min:"dataMin",max:"dataMax",axisPointer:{z:100}},{type:"category",gridIndex:1,data:r.categoryData,scale:!0,boundaryGap:!1,axisLine:{onZero:!1},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},splitNumber:20,min:"dataMin",max:"dataMax"}],yAxis:[{show:!0,scale:!0,axisLine:{show:!0,lineStyle:{color:"#999",width:0}},splitLine:{show:!0,lineStyle:{color:"#f7f7fa",width:1}}},{scale:!0,gridIndex:1,splitNumber:2,axisLabel:{show:!1},axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},splitLine:{show:!1}}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:70,end:100},{show:!1,xAxisIndex:[0,1],type:"slider",top:"85%",start:70,end:100}],series:[{name:"Dow-Jones index",type:"k",data:r.values,itemStyle:{normal:{color:"#00da3c",color0:"#ec0000",borderColor:null,borderColor0:null}},tooltip:{formatter:t=>["Date: "+(t=t[0]).name+'<hr size=1 style="margin: 3px 0">',"Open: "+t.data[0]+"<br/>","Close: "+t.data[1]+"<br/>","Lowest: "+t.data[2]+"<br/>","Highest: "+t.data[3]+"<br/>"].join("")}},{name:"MA5",type:"line",data:this.calculateMA(5,r),smooth:!0,lineStyle:{normal:{opacity:.5,width:1,height:1}}},{name:"MA10",type:"line",data:this.calculateMA(10,r),smooth:!0,lineStyle:{normal:{opacity:.5,width:1,height:1}}},{name:"MA20",type:"line",data:this.calculateMA(20,r),smooth:!0,lineStyle:{normal:{opacity:.5,width:1,height:1}}},{name:"MA30",type:"line",data:this.calculateMA(30,r),smooth:!0,lineStyle:{normal:{opacity:.5,width:1,height:1}}},{name:"Volume",type:"bar",xAxisIndex:1,yAxisIndex:1,data:r.volumes}]};y.datas[e]=i,a(i)},"JSON")}events(){$(".weui-navbar__item").on("click",t=>{$(t.currentTarget).hasClass("weui-bar__item--on")||($(".weui-bar__item--on").removeClass("weui-bar__item--on"),$(t.currentTarget).addClass("weui-bar__item--on"),this.rander($(t.currentTarget).data("chart")))}),$("#buy").on("click",t=>{$("#btntext").html("确定看涨"),$("#popup_sale").removeClass("weui-btn_primary"),$("#popup_sale").addClass("weui-btn_warn"),$("#full").popup(),y.datas.Type=1,this.contract_gear()}),$("#sale").on("click",t=>{$("#btntext").html("确定看跌"),$("#popup_sale").removeClass("weui-btn_warn"),$("#popup_sale").addClass("weui-btn_primary"),$("#full").popup(),y.datas.Type=2,this.contract_gear()}),$("#shous span").on("click",t=>{$("#shous span.active").removeClass("active"),$(t.currentTarget).addClass("active"),this.compute()}),$("#zsuns span").on("click",t=>{$("#zsuns span.active").removeClass("active"),$(t.currentTarget).addClass("active"),this.compute()}),$("#popup_sale").on("click",t=>{this.trade()})}contract_gear(){$.post("http://cqh.1caopan.com/index/api/contract_gear",{cid:y.datas.id,uid:localStorage.id,auth:localStorage.auth},t=>{1==t.code?(console.log(t),$("#zsun1").html(t.data[0].stop_loss_num),$("#zsun2").html(t.data[1].stop_loss_num),$("#zsun3").html(t.data[2].stop_loss_num),y.datas.bzj=t.data[0].bzj_gear,$("#jyzhf").html("???"),this.compute()):$.alert(t.msg)},"JSON")}compute(){let t=$("#shous").find("span.active").index();console.log(t);$("#zsuns").find("span.active").index();$("#bzj").html((t+1)*y.datas.bzj+"元")}trade(){let t={};t.Type=y.datas.Type,t.Num=$("#shous span.active").data("num"),1==y.datas.Type?t.LimitPrice=y.datas.UpperLimitPrice||0:t.LimitPrice=y.datas.LowerLimitPrice||0,t.InstrumentID=y.datas.qh.toLowerCase(),y.ws9001.send(f.REQORDERINSERT(t))}}$(()=>{new y})}]);